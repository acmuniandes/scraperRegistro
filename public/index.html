<!DOCTYPE html>
<html>
<head>
  <script src="https://code.jquery.com/jquery-3.2.1.slim.js" integrity="sha256-tA8y0XqiwnpwmOIl3SGAcFl2RvxHjA8qp0+1uCGmRmg=" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
  <script src="https://unpkg.com/vue"></script>
  <!-- <link rel="stylesheet" type="text/css" href="CSS.css"> -->
  <link href="https://fonts.googleapis.com/css?family=Raleway:100,300" rel="stylesheet">
  <script src="https://unpkg.com/vue-multiselect@2.0.0-beta.14"></script>
  <style src="https://unpkg.com/vue-multiselect@2.0.0-beta.14/dist/vue-multiselect.min.css"></style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.2/css/bootstrap-select.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.2/js/bootstrap-select.min.js"></script>

</head>

<body>
  <meta name="viewport" content="width=device-width">
  <div id='app' align=center>
    <div style="height:100px;">
      <h1>
        Salones Disponibles
      </h1>
      <div id="selector">
        <select v-model="selectedClassroom" class="selectpicker">
          <option selected></option>
          <option v-for="item in salones">{{item}}</option>
        </select>
      </div>
    </div>
    <div>
      <div v-if="selectedClassroom!=''" style="height:400px;overflow:scroll;-webkit-overflow-scrolling: touch;">
        <div id="cr" v-for="(disponible, index) in losSalones"  >
          <div v-for="horario in disponible" v-if="checkAvailable(horario)" class="container" style="width:200px;">
            <hr>
            <h1>{{index.replace("_","").replace(".","")}}</h1>
            <h2>âœ… hasta las <label>{{horario.split("-")[1]}}<label></h2>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script>

    var d = new Date();

    var weekday = new Array(7);

    weekday[0] =  "Domingo";
    weekday[1] = "Lunes";
    weekday[2] = "Martes";
    weekday[3] = "Miercoles";
    weekday[4] = "Jueves";
    weekday[5] = "Viernes";
    weekday[6] = "Sabado";

    var app = new Vue({
      el: '#app',
      data:{
        jsonObject: '',
        selectDay: true,
        selectedDay: d.getDay(),
        salones: ["AU","ML", "W", "TX", "R", "Q", "J", "H", "Ip", "B", "Z", "S1", "SD", "LL", "PU", "K2", "O"],
        selectedClassroom: ''
      },
      methods:{
        cargarSalones: function()
        {
          let networkPromise = fetch('/FreeClassrooms.json');
          networkPromise.then((rjson)=>{
            let parsinPromise = rjson.json();
            parsinPromise.then((rsalones)=>{
              this.jsonObject = rsalones;
            })
          })
        },
        checkAvailable: function(horario){
          var horas = horario.replace(/\s/g,'').split("-")
          var horaInicio = horas[0]
          var horaFinal = horas[1]
          if(this.hourToDisplay>horaInicio && this.hourToDisplay<horaFinal){
            return true;
          }
          return false;

        }
      },
      created: function()
      {
        this.cargarSalones();
      },
      computed:{
        losSalones: function(){
          salones = {};
          for(elemento in this.jsonObject)
          {
            if (elemento.includes('.'+this.selectedClassroom))
            {
              salones[elemento] = this.jsonObject[elemento][this.selectedDay];
            }
          }
          return salones;
        },
        dayToDisplay: function(){
          return weekday[this.selectedDay];
        },
        hourToDisplay: function(){
          return d.getHours()*100;
        }
      }
    });
    </script>
  </body>

  </html>
